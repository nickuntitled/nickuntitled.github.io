<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <title>1st customized Node-RED คือตัว Downloader | Nick Untitled</title><!-- Begin Jekyll SEO tag v2.8.0 -->
<meta name="generator" content="Jekyll v3.10.0" />
<meta property="og:title" content="1st customized Node-RED คือตัว Downloader" />
<meta name="author" content="Kittisak Chotikkakamthorn" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="None" />
<meta property="og:description" content="None" />
<link rel="canonical" href="https://nickuntitled.com/2021/04/21/1st-customized-node-red-is-downloader/" />
<meta property="og:url" content="https://nickuntitled.com/2021/04/21/1st-customized-node-red-is-downloader/" />
<meta property="og:site_name" content="Nick Untitled" />
<meta property="og:image" content="https://sgp1.digitaloceanspaces.com/nickuntitledasset/2021/04/922c64e6-bffb-4227-8b8d-8c1091d08652-1200x675.png" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2021-04-21T20:56:13+07:00" />
<meta name="twitter:card" content="summary_large_image" />
<meta property="twitter:image" content="https://sgp1.digitaloceanspaces.com/nickuntitledasset/2021/04/922c64e6-bffb-4227-8b8d-8c1091d08652-1200x675.png" />
<meta property="twitter:title" content="1st customized Node-RED คือตัว Downloader" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Kittisak Chotikkakamthorn"},"dateModified":"2024-03-16T09:47:16+07:00","datePublished":"2021-04-21T20:56:13+07:00","description":"None","headline":"1st customized Node-RED คือตัว Downloader","image":"https://sgp1.digitaloceanspaces.com/nickuntitledasset/2021/04/922c64e6-bffb-4227-8b8d-8c1091d08652-1200x675.png","mainEntityOfPage":{"@type":"WebPage","@id":"https://nickuntitled.com/2021/04/21/1st-customized-node-red-is-downloader/"},"url":"https://nickuntitled.com/2021/04/21/1st-customized-node-red-is-downloader/"}</script>
<!-- End Jekyll SEO tag -->
<link type="application/atom+xml" rel="alternate" href="https://nickuntitled.com/feed.xml" title="Nick Untitled" /><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
  <link rel="stylesheet" href="/assets/css/reset.css" />
  <link rel="stylesheet" href="/assets/css/normalize.css" />
  <link rel="stylesheet" href="/assets/css/main.css" />
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.css" integrity="sha384-OH8qNTHoMMVNVcKdKewlipV4SErXqccxxlg6HC9Cwjr5oZu2AdBej1TndeCirael" crossorigin="anonymous">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Thai:wght@700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Chakra+Petch:ital,wght@0,300;0,400;0,500;0,600;0,700;1,300;1,400;1,500;1,600;1,700&display=swap" rel="stylesheet">
</head>
<body a="auto">
    <main class="page-content" aria-label="Content">
      <div class="w">
        <p class = 'back-meta'>
    <a href="/">&lt; Nick Untitled</a>
</p><article>
  <h1 class = 'post-title'>1st customized Node-RED คือตัว Downloader</h1>

  <p class="post-meta">
    <time datetime="2021-04-21 20:56:13 +0700">2021-04-21</time>
  </p>

  
  <figure class = 'featured-image'>
      <img src = 'https://sgp1.digitaloceanspaces.com/nickuntitledasset/2021/04/922c64e6-bffb-4227-8b8d-8c1091d08652-1200x675.png' />
  </figure>
  

  <p>ต่อจากบทความก่อนหน้าที่พูดถึง<a href="https://nickuntitled.com/2021/03/27/customize-node-red-module-for-yourself/" rel="noreferrer noopener">การสร้าง Node ในโปรแกรม Node-RED ขึ้นมาใช้งานเอง</a> ตอนนี้ได้เขียนขึ้นมาชิ้นแรกที่เปิดเป็น public บน GitHub แล้วฮะ คือตัวดาวน์โหลดไฟล์</p>
<p>ปกติแล้วเวลาที่เราจะดาวน์โหลดไฟล์อะไรก็ตามเราก็กดเปิด URL แล้วปล่อยให้เว็บเบราวเซอร์มันทำงานเองใช่ไหมครับ แล้วถ้าเป็น Node-RED เราจะใช้งานอย่างไร อันนี้เป็นตัวอย่างนึงของการสร้าง Node ขึ้นมาใช้เอง แล้วเราจะเขียนอย่างไรล่ะ</p>
<blockquote><p>สำหรับคนที่ไม่อยากเขียนเอง ไปดาวน์โหลดไฟล์ได้ใน <a href="https://github.com/nickuntitled/node-red-contrib-downloader" rel="noreferrer noopener">Github ของผม</a>นะครับ</p></blockquote>
<p><!--more--></p>
<p>ถ้าเราอ่านโพสก่อนหน้าแล้ว จะพบว่าตัว Node ที่สร้างขึ้นมามีสามส่วนได้แก่ตัวไฟล์ package.json ที่กำหนดลักษณะของแพคเกจที่เราสร้างขึ้น สองคือไฟล์ JavaScript ที่กำหนดถึงการทำงานของ Node ส่วนที่สามเป็นไฟล์ HTML ซึ่งมีสองส่วนย่อยได้แก่ก็เป็นไฟล์ JavaScript ที่ตั้งค่าตัว Node ที่เราสร้างขึ้น และโค้ด HTML ที่กำหนดหน้าตาของตัว Node ที่เราสร้างขึ้น เรามาพูดถึงส่วนแรกก่อนก็คือตัวไฟล์ JavaScript</p>
<h2 id="package-json">Package.json</h2>
<p>ไฟล์ package.json เป็นไฟล์ที่กำหนดลักษณะแพคเกจของ Node ที่เราสร้างขึ้น เรากำหนดได้ตามโพสก่อนหน้านั้นเลย แต่ตามตัวอย่างนี้เราเขียนไปว่า</p>
<figure class="kg-card kg-image-card kg-card-hascaption"><img data-recalc-dims="1" decoding="async" src="https://nickuntitledasset.sgp1.cdn.digitaloceanspaces.com/2021/04/carbon.png?w=580&#038;ssl=1" class="kg-image" alt="" loading="lazy" /><figcaption>ตัวอย่าง package.json</figcaption></figure>
<h2 id="javascript">JavaScript</h2>
<p>ไฟล์ JavaScript ที่เราสร้างขึ้นจะกำหนดการทำงานของ Node-RED ซึ่งกรณีที่เราต้องการสร้างตัวดาวน์โหลดไฟล์ขึ้นมา เราจำเป็นต้องนำเข้าแพคเกจ http, https และ fs โดยแพคเกจ http, https ใช้เวลาเชื่อมต่อเข้ากับเซิร์ฟเวอร์ที่ไม่ได้เข้ารหัส กับเข้ารหัส และแพคเกจ fs เป็นแพคเกจที่มีหน้าที่จัดการกับตัวไฟล์ โดยเวลาดาวน์โหลดไฟล์ เราจะสร้างไฟล์ที่เก็บข้่อมูลที่เราดาวน์โหลดขึ้น ขั้นตอนแรก เรานำเข้าโดยพิมพ์คำสั่ง</p>
<figure class="kg-card kg-image-card kg-card-hascaption"><img data-recalc-dims="1" decoding="async" src="https://nickuntitledasset.sgp1.cdn.digitaloceanspaces.com/2021/04/carbon-1.png?w=580&#038;ssl=1" class="kg-image" alt="" loading="lazy" /><figcaption>นำเข้าแพคเกจ</figcaption></figure>
<p>เมื่อนำเข้าเสร็จแล้ว เรากำหนดการทำงานของตัว Node ที่เราสร้างขึ้นมา โดยเราสั่งคำสั่งให้สร้าง Node ขึ้น และตั้ง Event เวลาที่มีข้อมูลเข้ามาในตัวโหลดใน Event input ตามด้านล่างนี้</p>
<figure class="kg-card kg-image-card kg-card-hascaption"><img data-recalc-dims="1" decoding="async" src="https://nickuntitledasset.sgp1.cdn.digitaloceanspaces.com/2021/04/carbon-2.png?w=580&#038;ssl=1" class="kg-image" alt="" loading="lazy" /><figcaption>เขียนไฟล์ JavaScript ให้สร้าง Node ขึ้น รวมถึงสร้างฟังก์ชันเพื่อทำงานเวลาที่มีข้อมูลเข้ามาใน Node</figcaption></figure>
<p>ต่อมา เราพิมพ์คำสั่งในฟังก์ชันที่รันขึ้นเวลาที่มีข้อมูลเข้ามาใน <strong>node.on(&#8216;input&#8217;, </strong>เพื่อให้ดาวน์โหลด โดยรับข้อมูลจาก msg.payload เพื่อรับข้อมูล URL ที่ต้องการ, ชื่อไฟล์ที่เราต้องการเก็บข้อมูล โดยพิมพ์เพิ่มขึ้นเข้าไปตามภาพ (แต่เราจะพิมพ์แบบอื่นก็ได้นะ)</p>
<figure class="kg-card kg-image-card kg-card-hascaption"><img data-recalc-dims="1" decoding="async" src="https://nickuntitledasset.sgp1.cdn.digitaloceanspaces.com/2021/04/carbon-3.png?w=580&#038;ssl=1" class="kg-image" alt="" loading="lazy" /><figcaption>เพิ่มส่วนที่รับข้อมูลจาก Node ก่อนหน้าผ่าน msg.payload</figcaption></figure>
<p>เมื่อรับข้อมูลแล้ว เราจะสั่งให้ดาวน์โหลดไฟล์ เราจะสร้างเป็นฟังก์ชันสำหรับดาวน์โหลดไฟล์ก็ได้ หรือจะพิมพ์ลงไปในฟังก์ชัน <strong>node.on(&#8216;input&#8217;</strong> ก็ได้เช่นกัน แต่ของเราสร้างฟังก์ชันแยก เพื่อให้อ่านง่ายขึ้น โดยกำหนด <a href="https://nodejs.org/en/knowledge/advanced/streams/how-to-use-fs-create-write-stream/" rel="noreferrer noopener">fs.createwritestream</a> ก่อนเพื่อบอกว่าเราจะเขียนไฟล์แล้วนะ จากนั้นสร้างตัวแปลที่เป็นชนิด URL เพื่อแบ่งว่าเป็น http หรือ https ผ่าน ตัวแปรชนิด URL.protocol แล้ว เราจะสั่งให้ตัว Node ดาวน์โหลดผ่านคำสั่ง get</p>
<figure class="kg-card kg-image-card kg-card-hascaption"><img data-recalc-dims="1" decoding="async" src="https://nickuntitledasset.sgp1.cdn.digitaloceanspaces.com/2021/04/carbon-8.png?w=580&#038;ssl=1" class="kg-image" alt="" loading="lazy" /><figcaption>พิมพ์คำสั่งให้ดาวน์โหลดไฟล์ในขั้นตอนแรกก่อน ที่มามาจากเว็บ Stackoverflow นี้ครับ</figcaption></figure>
<p>เมื่อพิมพ์ไปตามภาพแล้ว จากนั้น เราต้องการเขียนไฟล์ที่ดาวน์โหลดได้ลงในไฟล์ที่เราสร้างขึ้น ทำได้โดยใช้ตัวแปร response ให้สั่งคำสั่ง pipe ให้เขียนลงไปเป็นไฟล์ที่เราต้องการตามภาพ</p>
<figure class="kg-card kg-image-card kg-card-hascaption"><img data-recalc-dims="1" decoding="async" src="https://nickuntitledasset.sgp1.cdn.digitaloceanspaces.com/2021/04/carbon-9.png?w=580&#038;ssl=1" class="kg-image" alt="" loading="lazy" /><figcaption>เขียนไฟล์ลงในไฟล์ผ่าน response.pipe</figcaption></figure>
<p>เมื่อทำเสร็จแล้ว เรามาพิมพ์คำสั่งเพิ่มเติมในฟังก์ชัน <strong>node.on(&#8216;input</strong>&#8216; เพื่อเรียกใช้คำสั่งเพื่อดาวน์โหลดไฟล์ด้วยตามภาพ</p>
<figure class="kg-card kg-image-card kg-card-hascaption"><img data-recalc-dims="1" decoding="async" src="https://nickuntitledasset.sgp1.cdn.digitaloceanspaces.com/2021/04/carbon-10.png?w=580&#038;ssl=1" class="kg-image" alt="" loading="lazy" /><figcaption>เขียนคำสั่งเพื่อเรียกใช้ฟังก์ชัน download</figcaption></figure>
<p>เมื่อเขียนเสร็จเรียบร้อย เซฟไฟล์ให้อยู่ในโฟลเดอร์ download ที่ชื่อว่า download.js</p>
<h2 id="-html">ไฟล์ HTML</h2>
<p>ขั้นตอนต่อไป เราจะมาเขียนในไฟล์ HTML ต่อ ซึ่งในไฟล์นี้จะกำหนดหน้าตาของการตั้งค่า Node รวมถึงตั้งค่าเริ่มต้นภายในตัว Node เอง เราสามารถสร้างไฟล์เป็น Node โล่ง ๆ แบบไม่มีอะไรเลยก็ได้ เพราะยังไงเราก็สั่งโดย Node ตัวอื่นมาก่อนหน้านั้นแล้วนะแหละ ในไฟล์นี้แบ่งเป็นสองส่วนได้แก่โค้ด JavaScript และโค้ด HTML</p>
<p>ส่วนแรกจะเป็นส่วน JavaScript ที่กำหนด Node ที่เราสร้างขึ้นว่ามีลักษณะอย่างไร และกำหนดค่าเริ่มต้นของ Node ซึ่งเราไม่ต้องมีก็ได้ แต่เราจะกำหนดค่าเริ่มต้นเฉพาะชื่อของ Node เองเพื่อให้คนจำได้ง่าย</p>
<figure class="kg-card kg-image-card kg-card-hascaption"><img data-recalc-dims="1" decoding="async" src="https://nickuntitledasset.sgp1.cdn.digitaloceanspaces.com/2021/04/carbon-13.png?w=580&#038;ssl=1" class="kg-image" alt="" loading="lazy" /><figcaption>ไฟล์ JavaScript ที่กำหนดตัว Node และกำหนดค่าเริ่มต้น</figcaption></figure>
<p>เมื่อกำหนดค่าเริ่มต้นอะไรเสร็จแล้ว จากนั้นเราเขียนโค้ด HTML เพื่อกำหนดลักษณะหน้าตาของการตั้งค่า และพิมพ์ข้อความอธิบาย Node ที่เราสร้างขึ้นให้คนเข้าใจ</p>
<figure class="kg-card kg-image-card kg-card-hascaption"><img data-recalc-dims="1" decoding="async" src="https://nickuntitledasset.sgp1.cdn.digitaloceanspaces.com/2021/04/carbon-14.png?w=580&#038;ssl=1" class="kg-image" alt="" loading="lazy" /><figcaption>ตัวอย่างการเขียนโค้ด HTML</figcaption></figure>
<p>เมื่อเขียนเสร็จแล้ว บันทึกไฟล์ downloader.html ลงในโพลเดอร์เดียวกันกับ JavaScript</p>
<h2 id="-">การติดตั้งแพคเกจ</h2>
<p>การติดตั้งแพคเกจทำได้สองวิธี หนึ่งคือพิมพ์คำสั่ง npm install ตรง ๆ ไปเลย หรืออีกวิธีหนึ่งคือทำเป็นไฟล์ .tgz เพื่อนำเข้าผ่านโปรแกรม Node-RED เราจะมาพูดถึงวิธีที่สอง เทคนิคนี้ทำได้โดยพิมพ์</p>
<figure class="kg-card kg-image-card kg-card-hascaption"><img data-recalc-dims="1" decoding="async" src="https://nickuntitledasset.sgp1.cdn.digitaloceanspaces.com/2021/03/carbon-8.png?w=580&#038;ssl=1" class="kg-image" alt="" loading="lazy" /><figcaption>การ pack ไฟล์ให้อยู่ในรูปไฟล์ tgz</figcaption></figure>
<p>จากนั้นเปิด Node-RED แล้วนำเข้าแพคเกจโดยเลือกไปที่ Manage Palette แล้วเลือกแท็บ install กับเลือกไฟล์ที่เรา pack ไว้ จากนั้นโปรแกรมจะอัพโหลดไฟล์เพื่อติดตั้งแพคเกจให้</p>
<h2 id="--1">การใช้งานแพคเกจนี้</h2>
<p>เราสั่งให้มันทำงานผ่านการส่งข้อมูลเป็นตัวแปร msg.payload ในรูปแบบ JSON โดยพิมพ์ตามภาพ</p>
<figure class="kg-card kg-image-card kg-card-hascaption"><img data-recalc-dims="1" decoding="async" src="https://nickuntitledasset.sgp1.cdn.digitaloceanspaces.com/2021/04/carbon-15.png?w=580&#038;ssl=1" class="kg-image" alt="" loading="lazy" /><figcaption>ตัวอย่างการพิมพ์คำสั่ง</figcaption></figure>
<p>เมื่อพิมพ์ไปแล้ว กด Deploy แล้วเริ่มการทำงานได้เลย เราจะพบว่าตัวโปรแกรมจะดาวน์โหลดให้ แต่มันไม่ได้แจ้งเตือนอะไร เราสามารถเพิ่มคำสั่งให้แสดงผลโดยใช้ node.status ได้เลย</p>
<p class = 'license'>
    <a href="#top">&uarr; Go to top</a>
</p></article><div class = 'license'>
    <hr />
    <p >
        &copy; 2025. Nick Untitled. / <a href = '/privacy-policy/'>Privacy Policy</a>
    </p>
</div>

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-RBEMC5RVL9"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-RBEMC5RVL9');
</script></div>
    </main>
  </body>
</html>